<ion-header>
  <ion-toolbar>
    <ion-title>Medication Manager</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="logout()">
        <ion-icon name="log-out-outline" slot="start"></ion-icon>
        Logout
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="container">
    <div class="welcome-section">
      <h2>Welcome Back!</h2>
      <p>Manage your health with confidence</p>
    </div>
    <p>Track your daily medications</p>

    <!-- Notification Permission Button -->
    <ion-card *ngIf="'Notification' in window && Notification.permission !== 'granted'">
      <ion-card-content>
        <p>Enable notifications for medication reminders</p>
        <ion-button expand="block" (click)="requestNotificationPermission()" color="tertiary">
          <ion-icon name="notifications-outline" slot="start"></ion-icon>
          Enable Notifications
        </ion-button>
      </ion-card-content>
    </ion-card>

    <!-- Medication Summary -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Today's Summary</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="summary-grid">
          <div class="summary-item">
            <h3>Total</h3>
            <p class="count total">{{ getMedicationsCount() }}</p>
          </div>
          <div class="summary-item">
            <h3>Taken</h3>
            <p class="count taken">{{ getTakenCount() }}</p>
          </div>
          <div class="summary-item">
            <h3>Not Taken</h3>
            <p class="count not-taken">{{ getNotTakenCount() }}</p>
          </div>
        </div>
        
        <div class="action-buttons">
          <ion-button expand="block" (click)="toggleMedicationForm()" color="primary">
            <ion-icon name="add-circle-outline" slot="start"></ion-icon>
            Add Medication
          </ion-button>
          
          <div class="button-row">
            <ion-button expand="block" (click)="saveMedications()" color="success" fill="outline">
              <ion-icon name="save-outline" slot="start"></ion-icon>
              Save All
            </ion-button>
            
            <ion-button expand="block" (click)="checkMedicationReminders()" color="warning" fill="outline">
              <ion-icon name="alarm-outline" slot="start"></ion-icon>
              Check Reminders
            </ion-button>
            
            <ion-button expand="block" (click)="clearAllMedications()" color="danger" fill="outline">
              <ion-icon name="trash-outline" slot="start"></ion-icon>
              Clear All
            </ion-button>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Add Medication Form -->
    <ion-card *ngIf="showMedicationForm">
      <ion-card-header>
        <ion-card-title>Add New Medication</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item>
          <ion-label position="stacked">Medication Name</ion-label>
          <ion-input 
            type="text" 
            [(ngModel)]="newMedication.name" 
            placeholder="e.g., Aspirin, Insulin">
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Dosage</ion-label>
          <ion-input 
            type="text" 
            [(ngModel)]="newMedication.dosage" 
            placeholder="e.g., 500mg, 10 units">
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Frequency</ion-label>
          <ion-input 
            type="text" 
            [(ngModel)]="newMedication.frequency" 
            placeholder="e.g., Once daily, Twice daily">
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Time</ion-label>
          <ion-input 
            type="text" 
            [(ngModel)]="newMedication.time" 
            placeholder="e.g., Morning, After meals">
          </ion-input>
        </ion-item>

        <div class="button-group">
          <ion-button expand="block" (click)="addMedication()" color="success">
            <ion-icon name="save-outline" slot="start"></ion-icon>
            Save Medication
          </ion-button>
          <ion-button expand="block" fill="outline" (click)="toggleMedicationForm()" color="medium">
            Cancel
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Medications List -->
    <ion-card *ngIf="medications.length > 0">
      <ion-card-header>
        <ion-card-title>Your Medications</ion-card-title>
        <ion-card-subtitle>Tap the circle to mark as Taken/Not Taken</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item *ngFor="let medication of medications" class="medication-item" [class.taken]="medication.isTaken">
            <ion-label>
              <h3>{{ medication.name }}</h3>
              <p>Dosage: {{ medication.dosage }}</p>
              <p>Frequency: {{ medication.frequency }}</p>
              <p>Time: {{ medication.time }}</p>
              <p *ngIf="medication.lastTaken" class="last-taken">
                Last taken: {{ medication.lastTaken | date:'shortTime' }}
              </p>
            </ion-label>
            
            <div class="medication-actions">
              <ion-button 
                fill="clear" 
                [color]="medication.isTaken ? 'success' : 'medium'" 
                (click)="toggleMedicationStatus(medication)"
                class="status-button">
                <ion-icon 
                  [name]="medication.isTaken ? 'checkmark-circle' : 'ellipse-outline'" 
                  size="large"
                  slot="icon-only">
                </ion-icon>
              </ion-button>
              
              <ion-button 
                fill="clear" 
                color="danger" 
                (click)="removeMedication(medication.id)">
                <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- Empty State -->
    <ion-card *ngIf="medications.length === 0 && !showMedicationForm">
      <ion-card-content class="empty-state">
        <ion-icon name="medical-outline" size="large"></ion-icon>
        <h3>No Medications Added</h3>
        <p>Click the button above to add your first medication</p>
      </ion-card-content>
    </ion-card>

    <!-- Logout Button -->
    <ion-button expand="block" (click)="logout()" color="danger" class="logout-btn">
      <ion-icon name="log-out-outline" slot="start"></ion-icon>
      Logout
    </ion-button>
  </div>
</ion-content>
